# ุณูุฑ ุงูุนูู ูุชุณุฌูู ุงูุทูุงุจ ุงูุฃูููุงูู

## ูุธุฑุฉ ุนุงูุฉ
ูุชู ุงูุณูุงุญ ููุทูุงุจ ุงูุฌุฏุฏ ุจุฅูุดุงุก ุญุณุงุจุงุช ุฌุฏูุฏุฉ ูู ุฎูุงู ุตูุญุฉ ุงูุชุณุฌูู. ุนูุฏ ุงุฎุชูุงุฑ ููุน ุงูุทุงูุจ **ุฃูููุงูู**ุ ูุชู ุฅุฑุณุงู ุทูุจ ุชุณุฌูู ูููุณุคูู ูููุฑุงุฌุนุฉ ูุงูููุงููุฉ.

## ูุฑุงุญู ุงูุณูุฑ

### 1๏ธโฃ ุงููุฑุญูุฉ ุงูุฃููู: ุฅูุดุงุก ุญุณุงุจ ูุฅุฑุณุงู ุทูุจ ุชุณุฌูู
**ุงูุตูุญุฉ:** `http://localhost:8080/auth`

ุงูุทุงูุจ ูููู ุจู:
1. ุงูููุฑ ุนูู **"ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"**
2. ุงุฎุชูุงุฑ **"๐ ุฃูููุงูู"** (ุฃู ุจูุงุก ุงูุฎูุงุฑ ุงูุงูุชุฑุงุถู ุนูู ุฃูููุงูู)
3. ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุชุงููุฉ:
   - ุงุณู ุงูุทุงูุจ โ
   - ุฑูู ุงููุงุชู โ
   - ูููุฉ ุงููุฑูุฑ โ
   - ุงูุตู ุงูุฏุฑุงุณู โ
   - ุงููุฌููุนุฉ (ุงุฎุชูุงุฑู)
   - ุงูููุฑุณุงุช ุงููุณุฌูุฉ โ
4. ุงูููุฑ ุนูู **"ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"**

**ุงูุนูููุฉ ูู ุงูุฎูููุฉ:**
```
Frontend (Auth.tsx)
  โ
createRegistrationRequest({
  name: "ุฃุญูุฏ ูุญูุฏ",
  phone: "01012345678",
  password: "password123",
  grade_id: "grade-1",
  group_id: "group-1",
  requested_courses: ["course-1", "course-2"],
  is_offline: false  โ ุชุญุฏูุฏ ุฃู ุงูุทุงูุจ ุฃูููุงูู
})
  โ
POST /api/registration-requests
  โ
Backend (registration-requests.ts)
  โ
INSERT INTO student_registration_requests
  (name, phone, password_hash, grade_id, group_id, 
   requested_courses, status='pending', is_offline=0, ...)
```

**ุงููุชูุฌุฉ:**
- โ ุชุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ: "ุชู ุฅุฑุณุงู ุทูุจ ุงูุชุณุฌูู ุจูุฌุงุญ"
- โ ูุชู ุฅูุดุงุก ุณุฌู ุทูุจ ุชุณุฌูู ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุญุงูุฉ ุงูุทูุจ = `pending` (ููุฏ ุงูุงูุชุธุงุฑ)
- โ ูุชู ุฅุนุงุฏุฉ ุชูุฌูู ุงูุทุงูุจ ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### 2๏ธโฃ ุงููุฑุญูุฉ ุงูุซุงููุฉ: ูุฑุงุฌุนุฉ ููุนุงูุฌุฉ ุงูุทูุจุงุช ูู ุงูุฅุฏุงุฑุฉ
**ุงูุตูุญุฉ:** `http://localhost:8080/registration-requests`

ุงููุณุคูู ููููู:
1. ุนุฑุถ ุฌููุน ุทูุจุงุช ุงูุชุณุฌูู ุงูุฃูููุงูู ุงูููุชุธุฑุฉ
2. ุฑุคูุฉ ุงููุนูููุงุช ุงูุชุงููุฉ ููู ุทุงูุจ:
   - ุงุณู ุงูุทุงูุจ
   - ุฑูู ุงููุงุชู
   - ุงูุตู ุงูุฏุฑุงุณู
   - ุงููุฌููุนุฉ
   - ุงูููุฑุณุงุช ุงููุณุฌูุฉ
   - ุชุงุฑูุฎ ุงูุทูุจ

#### โ ุฎูุงุฑ ุงููุจูู (Approve):
**ุงูุนูููุฉ:**
```
Admin ูุถุบุท "ูุจูู"
  โ
POST /api/registration-requests/{id}/approve
  โ
Backend ูููู ุจู:
1. ุฅูุดุงุก ูุณุชุฎุฏู (user) ุฌุฏูุฏ:
   INSERT INTO users (phone, password_hash, role='student', ...)
   
2. ุฅูุดุงุก ุณุฌู ุทุงูุจ (student):
   INSERT INTO students 
   (user_id, name, phone, grade_id, group_id, is_offline=0, 
    approval_status='approved', ...)
   
3. ุชุณุฌูู ุงูููุฑุณุงุช:
   INSERT INTO student_courses (student_id, course_id, ...)
   
4. ุชุญุฏูุซ ุญุงูุฉ ุทูุจ ุงูุชุณุฌูู:
   UPDATE student_registration_requests 
   SET status='approved' WHERE id=...
```

**ุงููุชูุฌุฉ:**
- โ ูุชู ุฅูุดุงุก ุญุณุงุจ ุงูุทุงูุจ ุจูุฌุงุญ
- โ ูุธูุฑ ุงูุทุงูุจ ูู ุตูุญุฉ `/students`
- โ ูููู ููุทุงูุจ ุงูุขู ุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ูุงุชูู ููููุฉ ุงููุฑูุฑ
- โ ูุชู ููู ุงูุทูุจ ุฅูู ุชุจููุจ "ููุจูู"

#### โ ุฎูุงุฑ ุงูุฑูุถ (Reject):
**ุงูุนูููุฉ:**
```
Admin ูุถุบุท "ุฑูุถ" ููุฏุฎู ุณุจุจ ุงูุฑูุถ
  โ
POST /api/registration-requests/{id}/reject
  {
    reason: "ุงูุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ ุฃู ุณุจุจ ุขุฎุฑ"
  }
  โ
Backend ูููู ุจู:
1. ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ:
   UPDATE student_registration_requests 
   SET status='rejected', rejection_reason='ุณุจุจ ุงูุฑูุถ'
   WHERE id=...
   
2. ูุง ูุชู ุฅูุดุงุก ุญุณุงุจ ููุทุงูุจ
```

**ุงููุชูุฌุฉ:**
- โ ูุชู ุญูุธ ุณุจุจ ุงูุฑูุถ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุง ูุชู ุฅูุดุงุก ุญุณุงุจ ููุทุงูุจ
- โ ูุชู ููู ุงูุทูุจ ุฅูู ุชุจููุจ "ูุฑููุถ"
- โ ูุง ูููู ููุทุงูุจ ุชุณุฌูู ุงูุฏุฎูู

---

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู: `student_registration_requests`
```sql
CREATE TABLE student_registration_requests (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  phone VARCHAR(20) NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  grade_id VARCHAR(36),
  group_id VARCHAR(36),
  requested_courses JSON,
  status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  rejection_reason TEXT,
  is_offline TINYINT(1) DEFAULT 0,  โ 0 = ุฃูููุงููุ 1 = ุฃูููุงูู
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### ุฌุฏูู: `students`
```sql
CREATE TABLE students (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36),
  name VARCHAR(255),
  phone VARCHAR(20),
  email VARCHAR(255),
  grade_id VARCHAR(36),
  group_id VARCHAR(36),
  is_offline TINYINT(1) DEFAULT 0,  โ ูุชู ูุณุฎ ูู ุงูุชุณุฌูู
  approval_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  approved_by VARCHAR(36),
  approved_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## ููุงุท ูููุฉ โ๏ธ

1. **ุงููุฑู ุจูู ุงูุฃูููุงูู ูุงูุฃูููุงูู:**
   - **ุฃูููุงูู (Online)**: ูุชู ุฅุฑุณุงู ุทูุจ ุชุณุฌูู ูุญุชุงุฌ ุฅูู ููุงููุฉ ุงูุฅุฏุงุฑุฉ
   - **ุฃูููุงูู (Offline)**: ุณูุชู ุชุทููุฑู ูุงุญูุงู (ูุถููู ุงูุฅุฏุงุฑุฉ ูุจุงุดุฑุฉ)

2. **ุงูุชุญูู ูู ุงูุจูุงูุงุช:**
   - ูุชู ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฑูู ูุงุชู ููุฑุฑ
   - ูุชู ุงูุชุญูู ูู ุฃู ุงุณู ุงูุทุงูุจ ููุฌูุฏ
   - ูุชู ุงูุชุญูู ูู ุงุฎุชูุงุฑ ุงูุตู ุงูุฏุฑุงุณู

3. **ุญุงูุงุช ุงูุทูุจ:**
   - `pending`: ููุฏ ุงูุงูุชุธุงุฑ - ุงูุทูุจ ุฌุฏูุฏ
   - `approved`: ููุจูู - ุชู ุฅูุดุงุก ุญุณุงุจ ุงูุทุงูุจ
   - `rejected`: ูุฑููุถ - ูู ูุชู ุฅูุดุงุก ุญุณุงุจ

4. **ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุดุงุฆุนุฉ:**
   - "ุฑูู ุงููุงุชู ูุณุฌู ุจุงููุนู" - ุฅุฐุง ูุงู ุงููุงุชู ููุฌูุฏ
   - "ูุฏูู ุทูุจ ุชุณุฌูู ููุฏ ุงููุฑุงุฌุนุฉ ุจุงููุนู" - ุฅุฐุง ูุงู ูุฏูู ุทูุจ ูุนูู

---

## API Endpoints

### ุฅูุดุงุก ุทูุจ ุชุณุฌูู ุฌุฏูุฏ
```
POST /api/registration-requests
Content-Type: application/json

{
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "phone": "01012345678",
  "password": "password123",
  "grade_id": "grade-id-1",
  "group_id": "group-id-1",
  "requested_courses": ["course-1", "course-2"],
  "is_offline": false
}

Response: 201
{
  "id": "request-id",
  "message": "ุชู ุฅุฑุณุงู ุทูุจ ุงูุชุณุฌูู ุจูุฌุงุญ"
}
```

### ุงูุญุตูู ุนูู ุทูุจุงุช ุงูุชุณุฌูู
```
GET /api/registration-requests?status=pending&is_offline=false
Authorization: Bearer {token}

Response: 200
[
  {
    "id": "request-id",
    "name": "ุฃุญูุฏ ูุญูุฏ",
    "phone": "01012345678",
    "grade_id": "grade-1",
    "grade_name": "ุงูุณุงุฏุณ ุงูุงุจุชุฏุงุฆู",
    "status": "pending",
    "is_offline": 0,
    "created_at": "2025-10-31T10:00:00Z"
  }
]
```

### ูุจูู ุทูุจ ุชุณุฌูู
```
POST /api/registration-requests/{id}/approve
Authorization: Bearer {token}

Response: 201
{
  "user": { ... },
  "student": { ... },
  "message": "ุชู ูุจูู ุงูุทูุจ ูุฅูุดุงุก ุญุณุงุจ ุงูุทุงูุจ"
}
```

### ุฑูุถ ุทูุจ ุชุณุฌูู
```
POST /api/registration-requests/{id}/reject
Authorization: Bearer {token}
Content-Type: application/json

{
  "reason": "ุงูุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ"
}

Response: 200
{
  "message": "ุชู ุฑูุถ ุงูุทูุจ"
}
```

---

## ุฎุทูุงุช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุฅูุดุงุก ุทูุจ ุชุณุฌูู
- ๐ ุงูุชุญ `http://localhost:8080/auth`
- โ๏ธ ุงุถุบุท "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"
- ๐ฏ ุงุฎุชุฑ "ุฃูููุงูู"
- ๐ ููุฃ ุงูุจูุงูุงุช
- โ ุงุถุบุท "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"
- โ ุชุญูู ูู ุฑุณุงูุฉ ุงููุฌุงุญ

### 2. ุงุฎุชุจุงุฑ ูุฑุงุฌุนุฉ ุงูุทูุจุงุช (ููุณุคูู)
- ๐ ุณุฌู ุงูุฏุฎูู ููุณุคูู
- ๐ ุงูุชุญ `http://localhost:8080/registration-requests`
- ๐ ุชุญูู ูู ุธููุฑ ุงูุทูุจ ุงูุฌุฏูุฏ
- โ ุงุถุบุท "ูุจูู" ุฃู "ุฑูุถ"

### 3. ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูุญุณุงุจ
- ๐ ุณุฌู ุงูุฏุฎูู ุจุฑูู ุงููุงุชู ููููุฉ ุงููุฑูุฑ
- ๐จโ๐ ูุฌุจ ุฃู ูุธูุฑ ุงูุทุงูุจ ูู `/students`
- โ ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ

---

## ููุงุญุธุงุช ูููุฉ
- โ ุฌููุน ุงูุจูุงูุงุช ูุดูุฑุฉ (password_hash)
- โ ุฌููุน ุงูุทูุจุงุช ุชุญุชุงุฌ ุฅูู ููุงููุฉ ูุฏููุฉ ูู ุงูุฅุฏุงุฑุฉ
- โ ูุง ูุชู ุฅูุดุงุก ุญุณุงุจ ุฅูุง ุจุนุฏ ุงูููุงููุฉ
- โ ุงูุทุงูุจ ุงููุฑููุถ ูุง ููููู ุชุณุฌูู ุงูุฏุฎูู
