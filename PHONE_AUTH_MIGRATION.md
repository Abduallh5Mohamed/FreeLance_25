# تغيير نظام التسجيل والدخول إلى نظام قائم على رقم الهاتف
# Phone-Based Authentication Migration

## التغييرات - Changes Made

### قاعدة البيانات - Database
- إضافة عمود `phone` في جدول `users` (VARCHAR(50) UNIQUE)
- إضافة عمود `phone_verified` للتحقق من الهاتف
- تحويل عمود `email` من إلزامي إلى اختياري (NULLABLE)
- إضافة فهرس على `phone` لتحسين الأداء

### الخادم - Backend
**ملف:** `server/src/routes/auth.ts`
- تحديث `/api/auth/login` لقبول `phone` أو `email` (للتوافق مع النظام القديم)
- تحديث `/api/auth/register` لقبول `phone` (إلزامي) و`email` (اختياري)
- تحديث JWT payload ليشمل `phone` و `email`

**ملف:** `server/src/routes/students.ts`
- إضافة GET `/api/students/phone/:phone` للبحث عن طالب برقم الهاتف

### الواجهة الأمامية - Frontend
**ملف:** `src/lib/api-http.ts`
- تحديث `signIn(phone, password)` - دالة تسجيل الدخول بالهاتف
- تحديث `signUp(phone, password, name, role, email?)` - التسجيل بالهاتف (البريد اختياري)
- إضافة `getStudentByPhone(phone)` - البحث عن طالب برقم الهاتف
- تحديث واجهة `User` لتشمل `phone` و `email` كأطر اختيارية

**ملف:** `src/pages/Auth.tsx`
- تحديث صفحة تسجيل الدخول/التسجيل لاستخدام رقم الهاتف بدلاً من البريد
- حقل الهاتف إلزامي لتسجيل الدخول والتسجيل
- حقل البريد الإلكتروني اختياري أثناء التسجيل فقط

## تشغيل الترحيل - Running the Migration

### 1. ترحيل قاعدة البيانات
```bash
mysql -u root -p < database/migrations/add_phone_to_users.sql
```

أو من داخل MySQL:
```sql
source d:/Freelance/FreeLance_25/database/migrations/add_phone_to_users.sql
```

### 2. إعادة بناء البيانات الحالية (إذا لزم الأمر)
إذا كانت لديك مستخدمين حاليين بدون رقم هاتف، يجب إضافة أرقام هواتف لهم:

```sql
-- مثال: إضافة رقم هاتف للمستخدمين الموجودين
UPDATE users SET phone = '01234567890' WHERE email = 'admin@example.com';
```

## استخدام النظام الجديد - Using the New System

### تسجيل الدخول - Login
```
رقم الهاتف: 01234567890
كلمة المرور: ********
```

### إنشاء حساب جديد - Registration
```
رقم الهاتف: 01234567890 (إلزامي)
البريد الإلكتروني: example@email.com (اختياري)
كلمة المرور: ********
الاسم: محمد أحمد
```

## التوافق مع النظام القديم - Backward Compatibility

النظام الحالي يدعم:
- ✅ تسجيل الدخول برقم الهاتف (الطريقة المفضلة)
- ✅ تسجيل الدخول بالبريد الإلكتروني (للتوافق مع البيانات القديمة)
- ✅ إنشاء حساب جديد بالهاتف فقط
- ✅ إنشاء حساب جديد بالهاتف + البريد (اختياري)

## ملاحظات مهمة - Important Notes

1. **رقم الهاتف فريد** - لا يمكن استخدام نفس رقم الهاتف لأكثر من مستخدم
2. **صيغة رقم الهاتف** - يجب إدخال الرقم بدون مسافات أو رموز خاصة (مثال: 01234567890)
3. **البريد الإلكتروني اختياري الآن** - يمكن إنشاء حساب بدون بريد إلكتروني
4. **الحسابات القديمة** - الحسابات التي لديها بريد فقط يمكنها تسجيل الدخول بالبريد

## الخطوات التالية - Next Steps

- [ ] إضافة التحقق من رقم الهاتف عبر OTP/SMS
- [ ] إضافة واجهة لتعديل رقم الهاتف في ملف المستخدم
- [ ] إضافة تحسينات على صيغة رقم الهاتف (دعم أكواد الدول)
- [ ] تحديث باقي الصفحات التي تستخدم البريد للبحث عن الطلاب
